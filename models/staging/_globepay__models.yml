version: 2

models:
  - name: stg_globepay_acceptance_report
    description: "cleans and transforms the acceptance report. one row per transaction attempt. adds amount_in_usd."
    columns:
      - name: external_ref
        description: "the unique transaction identifier."
        tests:
          - unique
          - not_null

  - name: stg_globepay_chargeback
    description: "lists all transactions that have been successfully charged back. one row per charged-back transaction."
    columns:
      - name: external_ref
        description: "the unique transaction identifier, used to join to the acceptance report."
        tests:
          - unique
          - not_null
          # test to ensure this ref also exists in the acceptance table
          - relationships:
              to: ref('stg_globepay_acceptance_report')
              field: external_ref